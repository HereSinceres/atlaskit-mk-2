Lots of internal factoring. No changes to external API yet.