fix incorrect origin tracing in analytics + small internal cleanups