fix bugs with error state